<NameSpace
 X="10"
 Y="190"
 Width="100"
 Height="50"
 Pinned="TRUE"
 Image="2"
 Name="JRU"
 Guid="eb4c743a-9cf0-4670-ae78-1c658e68b69d"
>
<Comment>Defines the communication interface with the Juridical Recording Unit, with procedures for sending the information and data types needed to store it.</Comment>
<NameSpaces>
<NameSpaceRef
 Name="GeneralMessage"
 Guid="08ee1a40-4c29-45cb-a6f1-68f493133bf6"
>
</NameSpaceRef><NameSpaceRef
 Name="Brakes"
 Guid="070c8cef-ca96-41df-9ae3-9240814d7852"
>
</NameSpaceRef><NameSpaceRef
 Name="TrainData"
 Guid="af6ecbce-3d64-498a-9961-bf8249c6ca56"
>
</NameSpaceRef><NameSpaceRef
 Name="Euroradio"
 Guid="0aaf078f-61fa-43ba-9f1e-50964ff19b3a"
>
</NameSpaceRef><NameSpaceRef
 Name="TrainInterface"
 Guid="7b56e97b-ed8d-4293-a7a4-c572b25bae69"
>
</NameSpaceRef><NameSpaceRef
 Name="DMI"
 Guid="61901117-54c9-4b59-9b4f-3a59816a8aad"
>
</NameSpaceRef><NameSpaceRef
 Name="AdditionalData"
 Guid="7431831d-2095-46f3-8ffb-6f7e91e441c1"
>
</NameSpaceRef><NameSpaceRef
 Name="Header"
 Guid="781d4b27-837b-4710-86ae-cf7f8660647b"
>
</NameSpaceRef><NameSpaceRef
 Name="LSSMA"
 Guid="d683951c-be6c-4e77-b17a-124301542830"
>
</NameSpaceRef><NameSpaceRef
 Name="NonLeading"
 Guid="2bafd0d2-bbae-4994-94e1-a05b4a44f6c0"
>
</NameSpaceRef><NameSpaceRef
 Name="PassiveShunting"
 Guid="832c1614-01f0-4189-83c3-1fa0faceca59"
>
</NameSpaceRef><NameSpaceRef
 Name="Sleeping"
 Guid="b0e08cee-53ef-4ee4-903b-6fd0e67b8904"
>
</NameSpaceRef><NameSpaceRef
 Name="SpeedAndDistanceMonitoring"
 Guid="5ce0c51b-5d9c-4bbe-b2ad-994bf17b5df3"
>
</NameSpaceRef><NameSpaceRef
 Name="Balise"
 Guid="59349317-7844-472e-89d3-2fa74620f994"
>
</NameSpaceRef><NameSpaceRef
 Name="VirtualBaliseCover"
 Guid="266f993d-9f80-4700-8a1b-93a304335ee3"
>
</NameSpaceRef><NameSpaceRef
 Name="NationalSystem"
 Guid="341d91a8-214a-4360-a3f7-d123d7ce1630"
>
</NameSpaceRef></NameSpaces>
<Collections>
<Collection
 TypeName="Messages.JRU.MESSAGE.Message"
 MaxSize="30"
 Default="[]"
 X="360"
 Y="10"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="JRUMessagesCollection"
 Guid="eb0177e5-5953-4de1-a99a-dd82f1fa7fd2"
>
<ReqRef
 Id="e394f9dd-0990-4f2d-ac8d-9a045f765d0a"
 SpecId="2218d057-3a1a-45e0-a1c9-ef26c3f85bc2"
 Guid="050b25e8-65e2-486c-b6ac-68da3940c92a"
>
</ReqRef><Comment>Collection which will contain all the sent Messages</Comment>
</Collection></Collections>
<Functions>
<Function
 Type="Boolean"
 Default=""
 X="30"
 Y="400"
 Width="100"
 Height="50"
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="IsStartUp"
 Guid="babeab5a-d445-4247-95dc-28b6ec7c28db"
>
<Comment>Indicates whether the train is at start up</Comment>
<Cases>
<Case
 Name="Always"
 Guid="f14f1e90-1e67-4cba-bbaf-42fe44bd3a9e"
>
<Expression>Kernel.Mode != LastMode AND LastMode == ModeEnum.NP</Expression>
</Case></Cases>
</Function><Function
 Type="ModeEnum"
 Default=""
 X="140"
 Y="400"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="GetMode"
 Guid="2a1206a9-73b0-4091-a358-af406e3f86ce"
>
<ReqRef
 Id="69f8e98d-1f04-42cd-bf44-eb4421190f26"
 SpecId="2218d057-3a1a-45e0-a1c9-ef26c3f85bc2"
 Guid="0ebcd2b1-3503-44b1-8abf-10b21ef0e1d6"
>
</ReqRef><Comment>Provides the OBU Mode</Comment>
<Cases>
<Case
 Name="Always"
 Guid="adfc126a-bc7a-4ff2-8735-1b2b95d36d7e"
>
<Expression>Kernel.Mode</Expression>
</Case></Cases>
</Function><Function
 Type="LevelDataStruct"
 Default=""
 X="250"
 Y="400"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="GetLevel"
 Guid="5e43ea12-9e1f-445d-9296-8dd836103091"
>
<ReqRef
 Id="7f57b812-cf8f-4798-ad1d-c4325c5f3cb2"
 SpecId="2218d057-3a1a-45e0-a1c9-ef26c3f85bc2"
 Guid="025927d3-a252-430c-92d3-bcb08cf2f167"
>
</ReqRef><Comment>Provides the OBU Level</Comment>
<Cases>
<Case
 Name="Always"
 Guid="7799ac71-81f1-4026-8e1e-c747275937c5"
>
<Expression>Kernel.Level.Value</Expression>
</Case></Cases>
</Function><Function
 Type="Boolean"
 Default=""
 X="360"
 Y="400"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="GetCabAActive"
 Guid="0c501f6d-3af0-415a-91b1-65152bc5e0a4"
>
<ReqRef
 Id="1a99e0b8-25e4-40b9-804a-adc887b38588"
 SpecId="2218d057-3a1a-45e0-a1c9-ef26c3f85bc2"
 Guid="42f3c06b-09e5-454b-b92d-04a2118233ba"
>
</ReqRef><ReqRef
 Id="8c425848-9e3f-47e1-b085-05409ddc4922"
 SpecId="2218d057-3a1a-45e0-a1c9-ef26c3f85bc2"
 Guid="069036a5-fdf0-4264-ac3f-9bbb06b98ac9"
>
</ReqRef><ReqRef
 Id="1d66e852-98d7-42e9-ac5a-f63774661b64"
 SpecId="2218d057-3a1a-45e0-a1c9-ef26c3f85bc2"
 Guid="5351183a-6a3c-4a04-a284-5641576cbf28"
>
</ReqRef><Comment>Indicates whether the CAB A is active</Comment>
<Cases>
<Case
 Name="Always"
 Guid="5d5f884a-9576-42f5-86fc-9cdaa729008e"
>
<Expression>TIU.CabA.Desk1IsActive OR TIU.CabA.Desk2IsActive</Expression>
</Case></Cases>
</Function><Function
 Type="Boolean"
 Default=""
 X="470"
 Y="400"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="GetCabBActive"
 Guid="3a8adf41-6251-488a-af08-0d04b5160c08"
>
<ReqRef
 Id="1a99e0b8-25e4-40b9-804a-adc887b38588"
 SpecId="2218d057-3a1a-45e0-a1c9-ef26c3f85bc2"
 Guid="c3b75657-4385-47a9-b40c-d92a2124df5d"
>
</ReqRef><ReqRef
 Id="8c425848-9e3f-47e1-b085-05409ddc4922"
 SpecId="2218d057-3a1a-45e0-a1c9-ef26c3f85bc2"
 Guid="2e42e12e-4846-452e-b8b3-70dbd7b936f0"
>
</ReqRef><ReqRef
 Id="1d66e852-98d7-42e9-ac5a-f63774661b64"
 SpecId="2218d057-3a1a-45e0-a1c9-ef26c3f85bc2"
 Guid="28e91894-3705-4483-a3f1-460dd8345fc3"
>
</ReqRef><Comment>Indicates whether the CAB B is active</Comment>
<Cases>
<Case
 Name="Train equipped with CAB B"
 Guid="55904cef-a9d0-4c55-905e-7318d8198b51"
>
<PreConditions>
<PreCondition
 Guid="e3fb07e6-13e1-4290-8ede-f3f10d9f60e3"
>Available( TIU.CabB )</PreCondition></PreConditions>
<Expression>TIU.CabB.Desk1IsActive OR TIU.CabB.Desk2IsActive</Expression>
</Case><Case
 Name="Otherwise"
 Guid="12bead29-267a-46da-a43d-c358a73fb9ad"
>
<Expression>False</Expression>
</Case></Cases>
</Function></Functions>
<Procedures>
<Procedure
 X="30"
 Y="580"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="UpdateLastValues"
 Guid="2a5e62a8-b526-4ac6-b22c-9044c822016a"
>
<ReqRef
 Id="69f8e98d-1f04-42cd-bf44-eb4421190f26"
 SpecId="2218d057-3a1a-45e0-a1c9-ef26c3f85bc2"
 Guid="7bec6f78-c84b-47f2-91b0-e60227fab680"
>
</ReqRef><ReqRef
 Id="7f57b812-cf8f-4798-ad1d-c4325c5f3cb2"
 SpecId="2218d057-3a1a-45e0-a1c9-ef26c3f85bc2"
 Guid="14d4dda7-a544-41ad-9d1f-e1e5df8e046c"
>
</ReqRef><ReqRef
 Id="8c425848-9e3f-47e1-b085-05409ddc4922"
 SpecId="2218d057-3a1a-45e0-a1c9-ef26c3f85bc2"
 Guid="35c4a5d1-a1b4-47f6-974e-dfa1cff3485b"
>
</ReqRef><ReqRef
 Id="1d66e852-98d7-42e9-ac5a-f63774661b64"
 SpecId="2218d057-3a1a-45e0-a1c9-ef26c3f85bc2"
 Guid="6263b248-5279-46b1-a248-07adbe3d5e45"
>
</ReqRef><Comment>Updates the registered values</Comment>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Update registered values"
 Guid="5592c5f4-a4ef-4fea-8f90-1cb4015ea532"
>
<Comment>Updates the registered values</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Update registered values"
 Guid="c94bdce6-ddc5-408e-aea5-e9abaff33fe9"
>
<PreConditions>
</PreConditions>
<Actions>
<Action
 Guid="656aa5dd-4481-4d77-8df1-acb2815140fa"
>LastLevel &lt;- GetLevel()</Action><Action
 Guid="b266ff25-5e73-4e2b-8f82-945fcd219ef7"
>LastMode &lt;- Kernel.Mode</Action><Action
 Guid="9c9991b3-318d-4643-9a2c-5eebe74fd994"
>LastCabAActive &lt;- GetCabAActive()</Action><Action
 Guid="12769e0f-7b02-4fda-90bb-ac26788009df"
>LastCabBActive &lt;- GetCabBActive()</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
</Procedure><Procedure
 X="30"
 Y="10"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="CreateMessages"
 Guid="d56c7c71-7758-48f4-9403-21b5b6abde63"
>
<ReqRef
 Id="1153a012-f94c-4ada-9412-ac62859d8d71"
 SpecId="2218d057-3a1a-45e0-a1c9-ef26c3f85bc2"
 Guid="da42cd31-fd8e-4f3d-8644-cd453bae7f31"
>
</ReqRef><ReqRef
 Id="197cdf74-a87b-417f-a977-6f74fd635cd0"
 SpecId="2218d057-3a1a-45e0-a1c9-ef26c3f85bc2"
 Guid="543c1554-bdf4-4b16-b866-0ae1587681de"
>
</ReqRef><ReqRef
 Id="d2655cc5-21f7-4522-96f9-bdfb23f40c80"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="85cc4749-c8ec-4700-8a6f-4dcc7bcef785"
>
</ReqRef><ReqRef
 Id="e394f9dd-0990-4f2d-ac8d-9a045f765d0a"
 SpecId="2218d057-3a1a-45e0-a1c9-ef26c3f85bc2"
 Guid="78fe126c-7a78-49e8-b6de-c57af3a5230b"
>
</ReqRef><ReqRef
 Id="1e4ca98b-fcef-4737-b4e3-38bfc4715927"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="a32ac59d-2281-4328-b912-3fc209ec346e"
>
</ReqRef><Comment>When necessary it will call the corresponding function to create a new JRU Message</Comment>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Create messages"
 Guid="1e2cb944-3c7b-4fe3-9f0e-39fc42fbae16"
>
<ReqRef
 Id="d1066713-c8af-44ac-abb4-93bef7fbff31"
 SpecId="2218d057-3a1a-45e0-a1c9-ef26c3f85bc2"
 Guid="4ff10845-3a67-4cb7-9794-b3424b164099"
>
</ReqRef><Comment>Create all JRU messages</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Create messages"
 Guid="08d9c251-b4ac-440a-9f0b-b5df551ead0b"
>
<PreConditions>
<PreCondition
 Guid="376874e6-e8eb-4663-a8dd-a3decea9331a"
>Kernel.ActiveFunctions.ProvideJuridicalData()</PreCondition></PreConditions>
<Actions>
<Action
 Guid="f4540f05-5b8a-413c-ae50-42c833e35804"
>AdditionalData.FillData()</Action><Action
 Guid="49dc8a2a-8a13-4e1f-9d5c-bcca2a83952d"
>Balise.FillData()</Action><Action
 Guid="dae13947-6355-482e-9adc-087347ebabc6"
>Brakes.FillData()</Action><Action
 Guid="c85a8672-dfb5-43ff-9ff0-33d660444556"
>DMI.FillData()</Action><Action
 Guid="d18e191e-9ca7-474c-81c6-45ac1d87d56d"
>Euroradio.FillData()</Action><Action
 Guid="4a276d0a-0317-4d56-bab2-b872b97d5ac4"
>GeneralMessage.FillData()</Action><Action
 Guid="ce23b2f4-369b-46e3-9a3d-df761f80ef37"
>LSSMA.FillData()</Action><Action
 Guid="c7795ff1-3b2f-494c-a476-458bda6f02a3"
>NationalSystem.FillData()</Action><Action
 Guid="ffff9b87-2b73-4a06-8ab7-2d36d162f985"
>NonLeading.FillData()</Action><Action
 Guid="c224d18b-84ab-4f67-bc8d-cc6860838cf2"
>PassiveShunting.FillData()</Action><Action
 Guid="0eb0dc55-6d8d-4085-a6f2-74fe2f282ac7"
>Sleeping.FillData()</Action><Action
 Guid="dfba3d5d-4f28-463a-a591-a0ca343b5944"
>SpeedAndDistanceMonitoring.FillData()</Action><Action
 Guid="3da306c4-5be9-4cb8-b7db-e9ae8caae517"
>TrainData.FillData()</Action><Action
 Guid="0fab7fb4-d8d7-4326-8712-a18ff4eb78df"
>TrainInterface.FillData()</Action><Action
 Guid="a1291d64-9ab6-43a2-bb62-e6c1d4191dee"
>VirtualBaliseCover.FillData()</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Update last values"
 Guid="1c1571d1-e3fa-43e0-a6f3-02dcd61d70f4"
>
<Comment>Updates the values required to detect changes</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Update last values"
 Guid="67299509-5c33-48a5-a1df-bb33c7499329"
>
<PreConditions>
</PreConditions>
<Actions>
<Action
 Guid="2ef865a1-03e8-4c11-9cd0-00ea496f03d1"
>UpdateLastValues()</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
</Procedure></Procedures>
<Variables>
<Variable
 Type="ModeEnum"
 DefaultValue="ModeEnum.NP"
 VariableMode="Internal"
 X="140"
 Y="460"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="LastMode"
 Guid="abcf37b7-5570-4118-89dc-669404a21f80"
>
<ReqRef
 Id="69f8e98d-1f04-42cd-bf44-eb4421190f26"
 SpecId="2218d057-3a1a-45e0-a1c9-ef26c3f85bc2"
 Guid="cb76e377-c84c-4c91-908d-e7e01d160a55"
>
</ReqRef></Variable><Variable
 Type="LevelDataStruct"
 DefaultValue="LevelDataStruct{
Value =&gt; LevelEnum.Unknown
}"
 VariableMode="Internal"
 X="250"
 Y="460"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="LastLevel"
 Guid="2d846361-1f75-4deb-b4a3-3d519fb61552"
>
<ReqRef
 Id="7f57b812-cf8f-4798-ad1d-c4325c5f3cb2"
 SpecId="2218d057-3a1a-45e0-a1c9-ef26c3f85bc2"
 Guid="0b2ad303-a186-4c78-b26f-27a559d2cfb2"
>
</ReqRef><Comment>The last reported status</Comment>
</Variable><Variable
 Type="Boolean"
 DefaultValue="False"
 VariableMode="Internal"
 X="360"
 Y="460"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="LastCabAActive"
 Guid="b34eac34-8073-4453-9976-d4369443f437"
>
<ReqRef
 Id="1a99e0b8-25e4-40b9-804a-adc887b38588"
 SpecId="2218d057-3a1a-45e0-a1c9-ef26c3f85bc2"
 Guid="87a2d878-4c4f-4057-9597-fe07bdac2214"
>
</ReqRef><ReqRef
 Id="8c425848-9e3f-47e1-b085-05409ddc4922"
 SpecId="2218d057-3a1a-45e0-a1c9-ef26c3f85bc2"
 Guid="fe3b205f-5813-44b4-ab9c-ea90d0b1f920"
>
</ReqRef><ReqRef
 Id="1d66e852-98d7-42e9-ac5a-f63774661b64"
 SpecId="2218d057-3a1a-45e0-a1c9-ef26c3f85bc2"
 Guid="2130a4ce-ab60-4072-a346-d7ddff5976d5"
>
</ReqRef><Comment>The last reported status</Comment>
</Variable><Variable
 Type="Boolean"
 DefaultValue="False"
 VariableMode="Internal"
 X="470"
 Y="460"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="LastCabBActive"
 Guid="fc5e1d79-7a3f-4b75-9e81-cad0b6e82d39"
>
<ReqRef
 Id="1a99e0b8-25e4-40b9-804a-adc887b38588"
 SpecId="2218d057-3a1a-45e0-a1c9-ef26c3f85bc2"
 Guid="ce66e69a-dba4-4603-b8f1-53d8cc97763d"
>
</ReqRef><ReqRef
 Id="8c425848-9e3f-47e1-b085-05409ddc4922"
 SpecId="2218d057-3a1a-45e0-a1c9-ef26c3f85bc2"
 Guid="4af28416-2713-4308-9e4f-f26a1e956f7e"
>
</ReqRef><ReqRef
 Id="1d66e852-98d7-42e9-ac5a-f63774661b64"
 SpecId="2218d057-3a1a-45e0-a1c9-ef26c3f85bc2"
 Guid="e3e9a472-4024-4f10-a92f-f5ca31f1ef01"
>
</ReqRef><Comment>The last reported status</Comment>
</Variable><Variable
 Type="JRUMessagesCollection"
 VariableMode="Outgoing"
 X="180"
 Y="10"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="Messages"
 Guid="6d84c01d-6133-40e4-8818-6573a4d31bdd"
>
<ReqRef
 Id="e394f9dd-0990-4f2d-ac8d-9a045f765d0a"
 SpecId="2218d057-3a1a-45e0-a1c9-ef26c3f85bc2"
 Guid="22f62718-63b1-4ab7-a539-2140b9332760"
>
</ReqRef><ReqRef
 Id="d2655cc5-21f7-4522-96f9-bdfb23f40c80"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="93d944bf-bb29-4160-9d0c-eeeee622ba04"
>
</ReqRef><Comment>The list of messages to be stored in the JRU</Comment>
</Variable></Variables>
<Rules>
<Rule
 Priority="CleanUp"
 X="30"
 Y="70"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="Delete stored messages"
 Guid="56de1c7b-cde1-4d6b-b73b-98da81bd3efa"
>
<ReqRef
 Id="e394f9dd-0990-4f2d-ac8d-9a045f765d0a"
 SpecId="2218d057-3a1a-45e0-a1c9-ef26c3f85bc2"
 Guid="b14726d8-2f3c-4c57-9dce-9382eb1b5025"
>
</ReqRef><Comment>Before the begining of a new cycle the list of messages should be deleted</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="DeleteStoredMessages"
 Guid="b1aac040-aade-4228-8029-1a59901be18f"
>
<Comment>Before the begining of a new cycle the list of messages should be deleted</Comment>
<PreConditions>
</PreConditions>
<Actions>
<Action
 Guid="4ab0f93d-c66b-4849-bbd8-5fe5d1895bcc"
>Messages &lt;- []</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
</NameSpace>
